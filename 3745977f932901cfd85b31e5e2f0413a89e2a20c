{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "e0ab1dc4_2564456d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2022-01-05T23:37:14Z",
      "side": 1,
      "message": "The BinaryData changes are, for me, getting to be too subtle to justify a ~10% performance improvement.\n\nTarget resolution is already super complicated and critical. Adding more complexity and optimization makes it harder to understand and to implement future changes (say, something like adding Rust support or, in the future, better built-in support for Fuchsia packaging).\n\nGN runtime improvements are nice (I sent a change to improve the Err object along these lines) but incremental performance improvements in GN wouldn\u0027t be on my list of the most important problems we have with the build that I would want to spend a \"complexity budget\" on.\n\nIf you want, maybe we should have a meeting next week with more people variously involved in the build to discuss where we think the bar for this kind of thing should be. I\u0027m also interested in a broader discussion (this might already be happening without me -- feel free to point me to any notes) about where GN work falls into overall build work. There are a bunch of things that I can think of that could be done, and some of them might be helped by changes in the GN tool.",
      "revId": "3745977f932901cfd85b31e5e2f0413a89e2a20c",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "60938742_9f291cc1",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000067
      },
      "writtenOn": "2022-01-11T15:40:32Z",
      "side": 1,
      "message": "Hi Brett,\n\nI would love to discuss GN evolution with you, because we have some drastic requirements for the Fuchsia build that are not currently met by GN. Also I\u0027m interested in any way to improve Rust supportin the tool.\n\nRegarding target resolution, I agree that the code is very complicated. My understanding is that this comes from the fact that Target::OnResolved() must pull a lot of different bits of information upwards in the build graph, in a way that is consistent with what later high level operations (i.e. analysis and ninja generation) expect, and keeping everything in sync in incredibly difficult (and makes changing behaviour even more difficult), since there are some many target types and special cases to consider.\n\nI do not think that my CL makes this complexity much worse, it just avoids a ton of un-necessary work and doesn\u0027t even touch the upper layers, but I respect your judgement here.\n\nLonger term, what would you think about changing the way dependent data is collected? For example, it should be possible to perform it on demand (e.g. at analysis / generation time), which would simplify a lot of code. The drawback would be that it _may_ be slower, though the work could be performed in parallel threads and some amount of memoization could be used to avoid repeated work (it\u0027s hard to tell in advance).",
      "parentUuid": "e0ab1dc4_2564456d",
      "revId": "3745977f932901cfd85b31e5e2f0413a89e2a20c",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c80cbb34_b8496727",
        "filename": "src/gn/target.cc",
        "patchSetId": 2
      },
      "lineNbr": 324,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2022-01-05T21:59:07Z",
      "side": 1,
      "message": "Is it possible to DCHECK here if `!IsBinary()`?",
      "revId": "3745977f932901cfd85b31e5e2f0413a89e2a20c",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "77b98b00_16e6cb47",
        "filename": "src/gn/target.cc",
        "patchSetId": 2
      },
      "lineNbr": 324,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2022-01-05T22:06:26Z",
      "side": 1,
      "message": "From the other patch, I understand how this works now and why we can\u0027t do this.",
      "parentUuid": "c80cbb34_b8496727",
      "revId": "3745977f932901cfd85b31e5e2f0413a89e2a20c",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "611400d2_a6c6f297",
        "filename": "src/gn/target.cc",
        "patchSetId": 2
      },
      "lineNbr": 324,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2022-01-05T22:34:30Z",
      "side": 1,
      "message": "Actually, I realize I\u0027m wrong again. I\u0027m worried some of this stuff is getting a little too subtle, let me start an email thread.",
      "parentUuid": "77b98b00_16e6cb47",
      "revId": "3745977f932901cfd85b31e5e2f0413a89e2a20c",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "df151606_38aa06dc",
        "filename": "src/gn/target.cc",
        "patchSetId": 2
      },
      "lineNbr": 539,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2022-01-05T21:59:07Z",
      "side": 1,
      "message": "It looks like this will create the binary_data_ object each time a target is resolved. Was that your intention? I thought this should only get created for binary targets.",
      "revId": "3745977f932901cfd85b31e5e2f0413a89e2a20c",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ef1600e2_f45fc00d",
        "filename": "src/gn/target.cc",
        "patchSetId": 2
      },
      "lineNbr": 786,
      "author": {
        "id": 1000397
      },
      "writtenOn": "2023-05-09T20:50:10Z",
      "side": 1,
      "message": "would it make more sense to implement this in `Target` (like it was before), but using `binary_data().configs_` and `binary_data().all_dependent_configs_` ?\n\nThat way you don\u0027t pass the target to the binary data that it owns, and the ownership / flow is a bit more clear?",
      "range": {
        "startLine": 774,
        "startChar": 0,
        "endLine": 786,
        "endChar": 1
      },
      "revId": "3745977f932901cfd85b31e5e2f0413a89e2a20c",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7c863347_0197e63d",
        "filename": "src/gn/target.h",
        "patchSetId": 2
      },
      "lineNbr": 575,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2022-01-05T21:59:07Z",
      "side": 1,
      "message": "Can you add a comment here about when this will be set and also that users should go through the binary_data() lazy accessor rather than using directly?",
      "range": {
        "startLine": 575,
        "startChar": 2,
        "endLine": 575,
        "endChar": 43
      },
      "revId": "3745977f932901cfd85b31e5e2f0413a89e2a20c",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6cd72cc8_4479eaf2",
        "filename": "src/gn/target.h",
        "patchSetId": 2
      },
      "lineNbr": 575,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2022-01-05T22:06:26Z",
      "side": 1,
      "message": "This should also mention the fact that this can be created for non-binary targets to avoid my confusion from the previous round.",
      "parentUuid": "7c863347_0197e63d",
      "range": {
        "startLine": 575,
        "startChar": 2,
        "endLine": 575,
        "endChar": 43
      },
      "revId": "3745977f932901cfd85b31e5e2f0413a89e2a20c",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    }
  ]
}