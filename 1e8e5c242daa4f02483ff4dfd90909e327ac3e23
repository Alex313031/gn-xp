{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "14b41282_5caf4132",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000067
      },
      "writtenOn": "2022-01-05T20:11:48Z",
      "side": 1,
      "message": "I have updated RJ\u0027s previous CL to make it work with current GN and simplify it a little. I have also performed measurements to see how this improves the situation. Sadly, that does not seem to speed up the build *at all* on my workstation. More precisely:\n\n- clean build time seems totally unaffected on my workstation, either with a cold or hot file system cache (I\u0027m using \"echo 3 | sudo tee /proc/sys/vm/drop_caches\"). I\u0027d like to try on my CloudTop (which is notorious for hideous I/O) though.\n\n- \"gn gen\" mean time is slightly faster (e.g. 13.7s -\u003e 12.9s)\n- Generated .ninja files are slightly smaller (i.e. 768 MiB -\u003e 736 MiB).\n- Mean \"ninja -C out/default -n\" time is slightly smaller (8.85s -\u003e 8.13s).\n- Max \"ninja -C out/default -n\" RSS peak is slightly smaller (1.047 GiB -\u003e 1.034 GiB).\n\nKeep in mind that still requires a custom Ninja binary built from upstream HEAD since there is no official release, and setting \"no_stamp_files \u003d true\" in the //.gn file, so it\u0027s not something we can roll to the Fuchsia build yet.\n\nTell me what you think about this. I will clean up this mega-CL into 3 separate ones for better review. I\u0027m still not sure it\u0027s worth it.\n",
      "revId": "1e8e5c242daa4f02483ff4dfd90909e327ac3e23",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c456c4dd_8d32d698",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000633
      },
      "writtenOn": "2022-01-05T20:29:12Z",
      "side": 1,
      "message": "This is in line with what I found in my experiments on my Z840. I also didn\u0027t find much performance difference on cloudtop either. The one open question on performance I had left was build execution on CQ/CI bots. This was not an easy experiment to perform at the time (not sure if it is different now), but I recall seeing a performance improvement and degradation in Fuchsia CQ/CI ninja build time that correlated with the time that this patch was active in the Fuchsia build. Correlation may not be causation in this case, but I think it\u0027s still worth checking.\n\nMy apologies for dropping the ball on this, I had hoped to wrap it up a long time ago. I think the outstanding work on this CL is likely to scrub documentation and add test cases for when phony is used.",
      "parentUuid": "14b41282_5caf4132",
      "revId": "1e8e5c242daa4f02483ff4dfd90909e327ac3e23",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d4932361_e931233f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000313
      },
      "writtenOn": "2022-01-17T17:36:39Z",
      "side": 1,
      "message": "Thanks for the update RJ.\nWho has the next step please?",
      "parentUuid": "c456c4dd_8d32d698",
      "revId": "1e8e5c242daa4f02483ff4dfd90909e327ac3e23",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "99a944d8_f768231e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000633
      },
      "writtenOn": "2022-01-19T18:28:07Z",
      "side": 1,
      "message": "I did a pass through David\u0027s changes and only had some minor nits. Overall, I think they simplify the patch set quite a bit. \n\nIdeally, the next step would be to gather numbers on whether this change impacts performance on CQ/CI bots. IIRC, phosek@ had an idea on how we could test an experimental GN on Fuchsia bots, but there were some changes needed to make that happen.\n\nAlternatively, we could try to land this first and then collect CQ/CI performance data. I would assume that is brettw@\u0027s call on whether that would be okay to do.\n\nI would really like to push this over the finish line, but I\u0027m a bit over-committed at the moment. I might be able to try to get docs and tests updated in the next couple weeks, unless someone else comes free first.",
      "parentUuid": "d4932361_e931233f",
      "revId": "1e8e5c242daa4f02483ff4dfd90909e327ac3e23",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "797bed98_1330a390",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000313
      },
      "writtenOn": "2022-01-19T20:14:36Z",
      "side": 1,
      "message": "Totally understandable that you don\u0027t have the time to get this past the finish line. David, can you take it from here? Up to you how to measure.",
      "parentUuid": "99a944d8_f768231e",
      "revId": "1e8e5c242daa4f02483ff4dfd90909e327ac3e23",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "04f61fe8_2ce492b2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2022-01-28T08:28:56Z",
      "side": 1,
      "message": "Another positive impact from this change is more accurate representation of build progress. In Fuchsia, ~55% of build targets are stamps, so if you see:\n\n  [1/252125] ...\n\nit doesn\u0027t mean you\u0027re going to actually build 252125 targets, in practice it\u0027s closer to 115000, the rest is just noise. The same applies to logs collected from bots, if you look at https://logs.chromium.org/logs/fuchsia/buildbucket/cr-buildbucket/8823812404606362721/+/u/build/ninja/stdout for example, more than half of that output are stamps which makes searching through logs increasingly painful as the size of that log increases.\n\nInterestingly, you wouldn\u0027t find the same noise in the output of a CMake build such as https://logs.chromium.org/logs/fuchsia/buildbucket/cr-buildbucket/8823810627321930977/+/u/clang/build/stdout because CMake doesn\u0027t use stamps, it uses phony.\n\nFor me, this UX improvement alone makes this change worth it.",
      "parentUuid": "797bed98_1330a390",
      "revId": "1e8e5c242daa4f02483ff4dfd90909e327ac3e23",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8c8dcd0b_c6f40fe2",
        "filename": "src/gn/target.h",
        "patchSetId": 5
      },
      "lineNbr": 389,
      "author": {
        "id": 1000633
      },
      "writtenOn": "2022-01-19T18:28:07Z",
      "side": 1,
      "message": "This is just dependency_output() now.",
      "range": {
        "startLine": 389,
        "startChar": 41,
        "endLine": 389,
        "endChar": 45
      },
      "revId": "1e8e5c242daa4f02483ff4dfd90909e327ac3e23",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ff7e557f_500a23eb",
        "filename": "src/gn/target.h",
        "patchSetId": 5
      },
      "lineNbr": 407,
      "author": {
        "id": 1000633
      },
      "writtenOn": "2022-01-19T18:28:07Z",
      "side": 1,
      "message": "Can remove.",
      "range": {
        "startLine": 407,
        "startChar": 0,
        "endLine": 407,
        "endChar": 5
      },
      "revId": "1e8e5c242daa4f02483ff4dfd90909e327ac3e23",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "846b25a7_639ba51f",
        "filename": "src/gn/target.h",
        "patchSetId": 5
      },
      "lineNbr": 415,
      "author": {
        "id": 1000633
      },
      "writtenOn": "2022-01-19T18:28:07Z",
      "side": 1,
      "message": "Can remove.",
      "range": {
        "startLine": 415,
        "startChar": 0,
        "endLine": 415,
        "endChar": 5
      },
      "revId": "1e8e5c242daa4f02483ff4dfd90909e327ac3e23",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    }
  ]
}