{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "5e472e4d_885a96ce",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 13
      },
      "lineNbr": 0,
      "author": {
        "id": 1000102
      },
      "writtenOn": "2021-12-09T16:37:43Z",
      "side": 1,
      "message": "I was curious if this makes a difference for chromium. I ran gn 5 times with and without this change in a normal linux release build and compared times with `ministat`:\n\n```\nthakis@thakis:~/src/chrome/src$ ministat gn_before.txt gn_after.txt \nx gn_before.txt\n+ gn_after.txt\n+----------------------------------------------------------------------------------------------------------------------------+\n|x                                                        +                            +     xxx      + +  +      x          |\n|                                  |___________________________________|_______A____________A_M_______M_________|___________||\n+----------------------------------------------------------------------------------------------------------------------------+\n    N           Min           Max        Median           Avg        Stddev\nx   5     6.0999482     6.4297416     6.3707993     6.3289123    0.13046022\n+   5     6.2659156     6.4108636     6.3962557     6.3648468   0.060054064\nNo difference proven at 95.0% confidence\n```\n\nSo apparently no effect for Chromium, at least on my machine, in the config I tried.",
      "revId": "a754274e2bb5c67349fa78451e8b6a8cdf94a078",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a5d5e359_0a1e5f27",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 13
      },
      "lineNbr": 0,
      "author": {
        "id": 1000102
      },
      "writtenOn": "2021-12-09T16:54:31Z",
      "side": 1,
      "message": "Turns out I failed at actually downloading the old gn binary before this change. If I actually compare gn before and after this version (this time with 10 runs each), it\u0027s a (small) win:\n\n```\nthakis@thakis:~/src/chrome/src$ ministat gn_before.txt gn_after.txt \nx gn_before.txt\n+ gn_after.txt\n+----------------------------------------------------------------------------------------------------------------------------+\n|                                                +                      x                    x                               |\n|+                   +       x   x     + +   +   +         +            x   +x  +        x   x x                            x|\n|                     |_______________________A__M___________________|________A__________M________________|                  |\n+----------------------------------------------------------------------------------------------------------------------------+\n    N           Min           Max        Median           Avg        Stddev\nx  10     6.1447179     6.7983904     6.5576789     6.4788159    0.19761204\n+  10     5.9508722     6.4947851     6.2788508      6.260378    0.16188029\nDifference at 95.0% confidence\n\t-0.218438 +/- 0.169721\n\t-3.37157% +/- 2.61963%\n\t(Student\u0027s t, pooled s \u003d 0.180632)\n```",
      "revId": "a754274e2bb5c67349fa78451e8b6a8cdf94a078",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "cd9f4625_7acef6cb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 13
      },
      "lineNbr": 0,
      "author": {
        "id": 1000067
      },
      "writtenOn": "2021-12-09T17:24:56Z",
      "side": 1,
      "message": "Interesting, I see a much larger difference on my local Chromium checkout:\n\n```\n$ repeat_cmd 9 buildtools/linux64/gn gen out/Release\nDone. Made 17155 targets from 3025 files in 4938ms\nDone. Made 17155 targets from 3025 files in 4898ms\nDone. Made 17155 targets from 3025 files in 4968ms\nDone. Made 17155 targets from 3025 files in 4945ms\nDone. Made 17155 targets from 3025 files in 4867ms\nDone. Made 17155 targets from 3025 files in 4916ms\nDone. Made 17155 targets from 3025 files in 5030ms\nDone. Made 17155 targets from 3025 files in 4888ms\nDone. Made 17155 targets from 3025 files in 4929ms\n\n$ repeat_cmd 9 /tmp/gn-origin-main~6 gen out/Release\nDone. Made 17155 targets from 3025 files in 5095ms\nDone. Made 17155 targets from 3025 files in 5010ms\nDone. Made 17155 targets from 3025 files in 4996ms\nDone. Made 17155 targets from 3025 files in 4974ms\nDone. Made 17155 targets from 3025 files in 4929ms\nDone. Made 17155 targets from 3025 files in 5006ms\nDone. Made 17155 targets from 3025 files in 5148ms\nDone. Made 17155 targets from 3025 files in 5127ms\nDone. Made 17155 targets from 3025 files in 4864ms\n\n$ repeat_cmd 9 /tmp/gn-origin-main~1 gen out/Release\nDone. Made 17155 targets from 3025 files in 4844ms\nDone. Made 17155 targets from 3025 files in 3512ms\nDone. Made 17155 targets from 3025 files in 3711ms\nDone. Made 17155 targets from 3025 files in 3594ms\nDone. Made 17155 targets from 3025 files in 3876ms\nDone. Made 17155 targets from 3025 files in 3745ms\nDone. Made 17155 targets from 3025 files in 3731ms\nDone. Made 17155 targets from 3025 files in 3789ms\nDone. Made 17155 targets from 3025 files in 3823ms\n\n$ repeat_cmd 9 /tmp/gn-origin-main gen out/Release\nDone. Made 17155 targets from 3025 files in 3413ms\nDone. Made 17155 targets from 3025 files in 3447ms\nDone. Made 17155 targets from 3025 files in 3529ms\nDone. Made 17155 targets from 3025 files in 3406ms\nDone. Made 17155 targets from 3025 files in 3435ms\nDone. Made 17155 targets from 3025 files in 3593ms\nDone. Made 17155 targets from 3025 files in 3522ms\nDone. Made 17155 targets from 3025 files in 3507ms\nDone. Made 17155 targets from 3025 files in 3642ms\n\n```\n\nThe first one is the current gn binary from the Chromium checkout.\n\nAll others are built locally with a recent Clang toolchain, linked with rpmalloc and with lto and icf enabled.\n\n/tmp/gn-origin-main~6 corresponds to origin/main~6 before any of my optimization patches, and its performance corresponds to the Chromium prebuilt.\n\n/tmp/gn-origin-main~1 is the source tree just before this patch, As you can see the latest one saves about 200ms even for Chromium.\n\nAs for memory:\n\n```\n$ repeat_cmd 3 /usr/bin/time -f%M buildtools/linux64/gn gen out/Release\nDone. Made 17155 targets from 3025 files in 5147ms\n719120\nDone. Made 17155 targets from 3025 files in 5068ms\n728104\nDone. Made 17155 targets from 3025 files in 5017ms\n735352\n\n$ repeat_cmd 3 /usr/bin/time -f%M /tmp/gn-origin-main gen out/Release\nDone. Made 17155 targets from 3025 files in 3447ms\n665156\nDone. Made 17155 targets from 3025 files in 3590ms\n672944\nDone. Made 17155 targets from 3025 files in 3341ms\n669636\n```\n\nWhich is also quite noticeable. I wonder what ministat is doing here?",
      "parentUuid": "a5d5e359_0a1e5f27",
      "revId": "a754274e2bb5c67349fa78451e8b6a8cdf94a078",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    }
  ]
}