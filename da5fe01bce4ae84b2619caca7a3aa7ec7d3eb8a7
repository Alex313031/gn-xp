{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "d609dba9_55bee005",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000067
      },
      "writtenOn": "2023-07-06T07:44:08Z",
      "side": 1,
      "message": "FWIW, this CL breaks the Fuchsia build, the error message looking like:\n\n```\n[14303/82221](114) RUST host_arm64-asan-ubsan/obj/src/developer/ffx/lib/buildid/libbuildid.rlib\nFAILED: host_arm64-asan-ubsan/obj/src/developer/ffx/lib/buildid/libbuildid.rlib\n../../build/tracer/output_cacher_local_wrapper.sh ../../prebuilt/third_party/python3/linux-x64/bin/python3.8 -S ../../build/tracer/restat_cacher.py --outputs host_arm64-asan-ubsan/obj/src/developer/ffx/lib/buildid/libbuildid.rlib host_arm64-asan-ubsan/obj/src/developer/ffx/lib/buildid/libbuildid.rlib.d -- ../../prebuilt/third_party/python3/linux-x64/bin/python3.8 -S ../../build/rbe/rustc_remote...\nerror: could not find native static library `buildid`, perhaps an -L flag is missing?\n\nerror: aborting due to previous error\n```\n\nI am currently investigating to determine the root cause of this... :-(",
      "revId": "da5fe01bce4ae84b2619caca7a3aa7ec7d3eb8a7",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c57c7985_edf69962",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000067
      },
      "writtenOn": "2023-07-06T08:14:41Z",
      "side": 1,
      "message": "Well, it looks like this patch does not deal correctly with an rlib that depends on a C++ static library using `#[link(name \u003d \"foo\", kind \u003d \"static\")]` in its `lib.rs` source.\n\nMy very naive understanding of Rust linking semantics make me believe that this CL should simply be reverted, but I would appreciate your feedback on the issue.\n\nMore details at https://bugs.fuchsia.dev/p/fuchsia/issues/detail?id\u003d130206",
      "revId": "da5fe01bce4ae84b2619caca7a3aa7ec7d3eb8a7",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "37c76087_214718c3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1002072
      },
      "writtenOn": "2023-07-06T14:01:45Z",
      "side": 1,
      "message": "Ah does it need lib paths to verify the library exists? The #[link] directive does not actually get consumed until link time, but its path could get fully resolved at compile time. I can fix this with another test pretty shortly.",
      "parentUuid": "c57c7985_edf69962",
      "revId": "da5fe01bce4ae84b2619caca7a3aa7ec7d3eb8a7",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d9a7f16c_e063ebde",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000067
      },
      "writtenOn": "2023-07-06T14:25:42Z",
      "side": 1,
      "message": "From the linked bug, the `rustdeps` line in the .ninja file needs these extra arguments: ` -Lnative\u003dhost_x64/obj/src/developer/ffx/lib/buildid/cpp -Clink-arg\u003d-Bdynamic -Clink-arg\u003dhost_x64/obj/src/developer/ffx/lib/buildid/cpp/libbuildid.a` in the action that generates the rlib itself.\n\nWithout this, building the rlib fails completely with: `error: could not find native static library `buildid`, perhaps an -L flag is missing?`.\n\nThe exact logs are not available publicly, but I just want to confirm that the .rlib creation itself fails, not the link of the final binaries that depend on it.",
      "parentUuid": "37c76087_214718c3",
      "revId": "da5fe01bce4ae84b2619caca7a3aa7ec7d3eb8a7",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0f7ce868_60b915af",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000067
      },
      "writtenOn": "2023-07-06T14:27:34Z",
      "side": 1,
      "message": "In other words, it looks like `#[link(name \u003d \"foo\", kind \u003d \"static\")]` forces the rust compiler to perform a linking operation when creating an .rlib file.\n\nThus the initial assumption that nonrustdeps are not needed for non-final targets is not true in general.",
      "parentUuid": "d9a7f16c_e063ebde",
      "revId": "da5fe01bce4ae84b2619caca7a3aa7ec7d3eb8a7",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    }
  ]
}