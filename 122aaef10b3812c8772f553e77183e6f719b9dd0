{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "35b56382_b9a46ff4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2021-05-14T04:20:43Z",
      "side": 1,
      "message": "Thanks for the updates and sorry for the headaches. For the big picture, I\u0027m trying to see if we can get the complexity down to the point where I think this is worth having in the tree. From my perspective zOS is an extremely obscure platform and so far it is adding more platform-specific ifdefs than anything but Windows.\n\nThe CCSID calls should just be removed from this patch so we don\u0027t check them in at all. We can re-evaluate when this patch then becomes smaller. But I\u0027m also concerned about the lack of thread_local support as I discuss in the comment below, and adding a whole implementation of thread_local for this one platform again adds complexity to this patch where I\u0027m not sure it\u0027s worth it. Maybe the compiler team can implement this first?",
      "revId": "122aaef10b3812c8772f553e77183e6f719b9dd0",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c8ed50ea_dbcf78c4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1000602
      },
      "writtenOn": "2021-05-15T04:33:11Z",
      "side": 1,
      "message": "About \"The CCSID calls should just be removed\", please note that I already removed all of them (in https://gn-review.googlesource.com/c/gn/+/11580/1).",
      "parentUuid": "35b56382_b9a46ff4",
      "revId": "122aaef10b3812c8772f553e77183e6f719b9dd0",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f6f91d91_bd57ae14",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2021-05-15T15:11:36Z",
      "side": 1,
      "message": "I was thinking about this some more. Even outside of the thread_local changes, I think there is too much platform complexity for the benefit to the entire project. But I\u0027m still fine if you want to have a zos branch in the repo.\n\nIf it\u0027s a branch, I\u0027m not worried about the amount of changes so you can keep the ASCII tags and also have a proper thread local implementation for the places where it\u0027s used. This seems like the best solution.\n\nI\u0027ve not used branches in Gerrit before, hopefully that \"just works\" or is easy to figure out.",
      "revId": "122aaef10b3812c8772f553e77183e6f719b9dd0",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "30bb560d_e97106bf",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1000602
      },
      "writtenOn": "2021-05-17T17:27:25Z",
      "side": 1,
      "message": "OK, I\u0027ll work on moving this patch to a zos branch. I\u0027ll also delete zos_util.* in the GN patch and instead use the functionality there from a \u0027zoslib\u0027 repo (https://github.com/ibmruntimes/zoslib), which also includes a workaround implementation for thread_local (but still requires an extra line of code where thread_local is used). Using zoslib repo will reduce the complexity in GN due to z/OS support. Is it OK for the zos branch of GN to have a dependency on zoslib repo?",
      "parentUuid": "f6f91d91_bd57ae14",
      "revId": "122aaef10b3812c8772f553e77183e6f719b9dd0",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "40f629c2_0cc18b4b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2021-05-17T18:53:30Z",
      "side": 1,
      "message": "I want to avoid licencing complexity so I don\u0027t want third party libraries checked in, but on your own branch I\u0027m fine if you require users to download something else.\n\nIn your branch I\u0027d add a README_zos.md in the root directory with the extra setup requirements.",
      "parentUuid": "30bb560d_e97106bf",
      "revId": "122aaef10b3812c8772f553e77183e6f719b9dd0",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e9f179af_6de1a89c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1000602
      },
      "writtenOn": "2021-05-17T19:33:23Z",
      "side": 1,
      "message": "Yes for sure I didn\u0027t mean to check-in zoslib, but to add a note in README.md; however I\u0027ll add the note in a README_zos.md as you suggested.",
      "parentUuid": "40f629c2_0cc18b4b",
      "revId": "122aaef10b3812c8772f553e77183e6f719b9dd0",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9185b096_6e01a082",
        "filename": "src/gn/exec_process.cc",
        "patchSetId": 3
      },
      "lineNbr": 34,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2021-05-14T04:20:43Z",
      "side": 1,
      "message": "If we need this include, just make it unconditional and move up to the top group since it will work on all platforms.",
      "revId": "122aaef10b3812c8772f553e77183e6f719b9dd0",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d8382ba4_1196f375",
        "filename": "src/gn/exec_process.cc",
        "patchSetId": 3
      },
      "lineNbr": 34,
      "author": {
        "id": 1000602
      },
      "writtenOn": "2021-05-14T15:06:05Z",
      "side": 1,
      "message": "Thanks, I removed the ifdef and moved sys/time.h to under non-OS_WIN group, please see patch https://gn-review.googlesource.com/c/gn/+/11600/2",
      "parentUuid": "9185b096_6e01a082",
      "revId": "122aaef10b3812c8772f553e77183e6f719b9dd0",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a9886da0_dda04def",
        "filename": "src/gn/exec_process.cc",
        "patchSetId": 3
      },
      "lineNbr": 34,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2021-05-14T22:49:00Z",
      "side": 1,
      "message": "We should just apply those changes to this patch so we only have one patch going.",
      "parentUuid": "d8382ba4_1196f375",
      "revId": "122aaef10b3812c8772f553e77183e6f719b9dd0",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c769fc97_0aef6895",
        "filename": "src/gn/exec_process.cc",
        "patchSetId": 3
      },
      "lineNbr": 34,
      "author": {
        "id": 1000602
      },
      "writtenOn": "2021-05-15T04:33:11Z",
      "side": 1,
      "message": "How do I git commit/push to apply a change to this patch (https://gn-review.googlesource.com/c/gn/+/11520/1) ? Do I specify:\nChange-Id: Id06e12c9ca88424a9495a5a2d1ed4e2575185196\n(this patch\u0027s) at the bottom of the commit message?\n\nIf so, will the message in the new commit become this patch\u0027s commit message?",
      "parentUuid": "a9886da0_dda04def",
      "revId": "122aaef10b3812c8772f553e77183e6f719b9dd0",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "aac908d8_32c5dd3a",
        "filename": "src/gn/exec_process.cc",
        "patchSetId": 3
      },
      "lineNbr": 34,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2021-05-17T18:53:30Z",
      "side": 1,
      "message": "I was also confused about this when I started using Gerrit. If you want future changes to go into the same patch, do \"git commit --amend\" so you only have the one commit in your local branch. I used to like to have multiple commits locally but this workflow doesn\u0027t make Gerrit happy.\n\nGerrit uses the Change-Id line you identified, so to get back to this state, somehow (squash merge or whatever you can make work) get one local commit on top of gn HEAD with this line at the bottom.\n\nI unfortunately don\u0027t know how to make an upstream branch in Gerrit so you may have to do some research on that.",
      "parentUuid": "c769fc97_0aef6895",
      "revId": "122aaef10b3812c8772f553e77183e6f719b9dd0",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "00992e97_c24ab08e",
        "filename": "src/gn/exec_process.cc",
        "patchSetId": 3
      },
      "lineNbr": 34,
      "author": {
        "id": 1000602
      },
      "writtenOn": "2021-08-04T18:57:40Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "aac908d8_32c5dd3a",
      "revId": "122aaef10b3812c8772f553e77183e6f719b9dd0",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c068ca06_7ab439e8",
        "filename": "src/gn/ninja_rust_binary_target_writer_unittest.cc",
        "patchSetId": 3
      },
      "lineNbr": 813,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2021-05-14T04:20:43Z",
      "side": 1,
      "message": "Since the zos version of the code works either way, I think we can just use it and remove the ifdef.",
      "revId": "122aaef10b3812c8772f553e77183e6f719b9dd0",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "47956b4d_e50b775a",
        "filename": "src/gn/ninja_rust_binary_target_writer_unittest.cc",
        "patchSetId": 3
      },
      "lineNbr": 813,
      "author": {
        "id": 1000602
      },
      "writtenOn": "2021-05-14T15:06:55Z",
      "side": 1,
      "message": "Done, in https://gn-review.googlesource.com/c/gn/+/11600/2",
      "parentUuid": "c068ca06_7ab439e8",
      "revId": "122aaef10b3812c8772f553e77183e6f719b9dd0",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0e0413c7_b62c4549",
        "filename": "src/gn/string_atom.cc",
        "patchSetId": 3
      },
      "lineNbr": 211,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2021-05-14T04:20:43Z",
      "side": 1,
      "message": "This change is not safe and will cause data corruption and probably crashes.\n\nSome minor compiler workarounds are OK with me (the pair emplace change you made is OK with me). But we require a generally compliant C++17 compiler and I don\u0027t want to accumulate workarounds for such fundamental things as thread_local, especially as in this case when the workarounds are relatively complicated.\n\nGN will not be usable on zos with the current code so I\u0027m reluctant to land anything in this state.",
      "revId": "122aaef10b3812c8772f553e77183e6f719b9dd0",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3a2b1c44_e98efa6a",
        "filename": "src/gn/string_atom.cc",
        "patchSetId": 3
      },
      "lineNbr": 211,
      "author": {
        "id": 1000602
      },
      "writtenOn": "2021-05-14T15:15:56Z",
      "side": 1,
      "message": "I removed the ifdef for thread_local, and worked around it in build/gen.py (https://gn-review.googlesource.com/c/gn/+/11600/2) to reduce the clutter.\n\nAbout \"GN will not be usable on zos with the current code\": in all my runs of \u0027gn gen\u0027 to build V8 (the reason for porting GN to z/OS, as we are porting standalone V8), gn never crashed in any of my many runs, including running out/gn_unittests. Yes it could be by luck, but we have been able to use this ported GN successfully on z/OS - otherwise I wouldn\u0027t checkin code that crashes :)",
      "parentUuid": "0e0413c7_b62c4549",
      "revId": "122aaef10b3812c8772f553e77183e6f719b9dd0",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cd2e3144_90c6c9d7",
        "filename": "src/gn/string_atom.cc",
        "patchSetId": 3
      },
      "lineNbr": 211,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2021-05-14T22:49:00Z",
      "side": 1,
      "message": "I think you\u0027re getting lucky because (if I recall) V8 only has the one build file. But this is being called from multiple threads with no locking, so any builds files are executed in parallel (the normal case for almost all of the projects that use GN), I believe this will crash fairly quickly.",
      "parentUuid": "3a2b1c44_e98efa6a",
      "revId": "122aaef10b3812c8772f553e77183e6f719b9dd0",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1143a0c3_7558bbad",
        "filename": "src/gn/string_atom.cc",
        "patchSetId": 3
      },
      "lineNbr": 211,
      "author": {
        "id": 1000602
      },
      "writtenOn": "2021-05-15T04:48:37Z",
      "side": 1,
      "message": "According to https://v8.dev/docs/build-gn, before a V8 build, I run with something like \u0027gn gen out/zos_s390x.release ...\u0027 only once. It generates several (95) .ninja files and 1 .ninja.d file. This gn step never crashed for me (and I ran it many times). After that I run ninja to start the build.\n\nI do have a custom implementation for thread_local, but didn\u0027t add it to avoid cluttering the code, especially since (so far) I didn\u0027t see a need for it.\n\nI can add the implementation-specific code in zos_util.cc, and in the 2 places where thread_local is used, I\u0027d have a ifdef with an extra line of code.\n\nPlease advise on whether I should make this change; another option is to leave it as is, and if an issue was encountered, then we can revisit it.",
      "parentUuid": "cd2e3144_90c6c9d7",
      "revId": "122aaef10b3812c8772f553e77183e6f719b9dd0",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "59dac704_0441a57f",
        "filename": "src/gn/string_atom.cc",
        "patchSetId": 3
      },
      "lineNbr": 211,
      "author": {
        "id": 1000602
      },
      "writtenOn": "2021-08-04T18:57:40Z",
      "side": 1,
      "message": "In the latest commit, I\u0027ve used a thread_local implementation (__tlssim class) from zoslib (https://github.com/ibmruntimes/zoslib).",
      "parentUuid": "1143a0c3_7558bbad",
      "revId": "122aaef10b3812c8772f553e77183e6f719b9dd0",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7ca6e71a_408e1bae",
        "filename": "src/gn/string_atom.cc",
        "patchSetId": 3
      },
      "lineNbr": 211,
      "author": {
        "id": 1000602
      },
      "writtenOn": "2021-08-11T15:31:57Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "59dac704_0441a57f",
      "revId": "122aaef10b3812c8772f553e77183e6f719b9dd0",
      "serverId": "c360c8e5-7aa8-3905-a7a0-810934766dac"
    }
  ]
}